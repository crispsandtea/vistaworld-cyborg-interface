<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>vistaworld // System Unit 393AP</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=VT323&family=Press+Start+2P&family=DM+Mono&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;overflow:hidden;}

:root{
  --cyan:#00ffea;
  --magenta:#ff00ff;
  --blue:#4169ff;
  --yellow:#ffff00;
}

body{
  background:#000;
  font-family:'VT323', monospace;
  cursor: none; /* hide default cursor for neon */
}

/* NEON CURSOR */
#neon-cursor {
  position: fixed;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  pointer-events: none;
  mix-blend-mode: screen;
  background: radial-gradient(circle, #00ffea 0%, #ff00ff 60%, #4169ff 100%);
  box-shadow: 0 0 10px #00ffea, 0 0 20px #ff00ff, 0 0 30px #4169ff;
  transform: translate(-50%, -50%);
  transition: transform 0.05s ease, box-shadow 0.2s ease;
}

/* BACKGROUND */
.desktop-bg{
  position:fixed;
  inset:0;
  background:url("hyperconnectivity.jpg") center/cover no-repeat;
  z-index:0;
}
.desktop-bg::after{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.45);
}

/* CRT SCANLINES + FLICKER */
.crt-overlay {
  position: fixed;
  inset:0;
  pointer-events: none;
  background: repeating-linear-gradient(
    180deg,
    rgba(0,0,0,0) 0,
    rgba(0,0,0,0.03) 1px
  );
  mix-blend-mode: overlay;
  animation: flicker 0.15s infinite;
  z-index:1000;
}
@keyframes flicker {
  0%{opacity:0.05;}
  50%{opacity:0.15;}
  100%{opacity:0.05;}
}

/* WINDOWS */
.window{
  position:absolute;
  background:rgba(15,15,15,0.95);
  border:2px solid;
  border-radius:8px;
  box-shadow:0 0 30px rgba(0,0,0,0.8);
  overflow:hidden;
}

.window-header{
  padding:8px 12px;
  background:linear-gradient(#2a2a2a,#111);
  border-bottom:2px solid;
  cursor:move;
  display:flex;
  justify-content:space-between;
  align-items:center;
  user-select:none;
}

.window-title{
  font-family:'Press Start 2P', monospace;
  font-size:10px;
}

.window-controls{display:flex;gap:6px;}
.window-btn{width:14px;height:14px;border-radius:2px;cursor:pointer;}
.close{background:#ff5f56;}
.minimize{background:#ffbd2e;}
.maximize{background:#27c93f;}

.window-content{
  padding:16px;
  color:#fff;
  font-size:16px;
  line-height:1.5;
}

#network-window .window-content{
  padding:12px;
}

/* CONTENT */
.logo-text{
  font-family:'Press Start 2P', monospace;
  font-size:48px;
  white-space:nowrap;
  color:var(--blue);
  text-shadow:3px 3px 0 var(--magenta),6px 6px 0 var(--cyan);
}

.system-avatar{width:100%;border:2px solid var(--cyan);background:#fff;}
.system-label{margin-top:10px;font-family:'Press Start 2P';font-size:10px;color:var(--cyan);}

.hlsp-image{width:100%;border:2px solid var(--yellow);background:#fff;cursor:pointer;}
.hlsp-caption{margin-top:10px;font-size:14px;color:var(--yellow);}

.network-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  text-align:center;
}
.network-grid a{
  color:var(--yellow);
  font-size:26px;
  text-decoration:none;
  transition:transform 0.2s;
  display:block;
}
.network-grid a:hover{transform:scale(1.2);}

/* TASKBAR */
.taskbar{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:50px;
  background:rgba(10,10,10,0.95);
  border-top:2px solid var(--cyan);
  display:flex;
  align-items:center;
  padding:0 20px;
  z-index:500;
}
.taskbar-time{margin-left:auto;color:var(--magenta);}

/* CHAT INTERFACE */
#chat-messages{
  height:300px;
  overflow-y:auto;
  margin-bottom:12px;
  padding:8px;
  border:1px solid var(--cyan);
  background:rgba(0,0,0,0.3);
}
.chat-msg{
  margin-bottom:12px;
  padding:8px;
  border-left:3px solid;
}
.user-msg{border-color:var(--magenta);color:var(--magenta);}
.ai-msg{border-color:var(--cyan);color:var(--cyan);}
#chat-input{
  width:calc(100% - 80px);
  padding:8px;
  background:rgba(0,0,0,0.5);
  border:2px solid var(--cyan);
  color:var(--cyan);
  font-family:'VT323',monospace;
  font-size:16px;
}
#send-btn{
  width:70px;
  padding:8px;
  background:var(--cyan);
  border:none;
  color:#000;
  font-family:'Press Start 2P',monospace;
  font-size:8px;
  cursor:pointer;
  margin-left:8px;
}
#send-btn:hover{background:var(--magenta);}
</style>
</head>

<body>
<div class="desktop-bg"></div>
<div class="crt-overlay"></div>
<div id="neon-cursor"></div>

<div class="desktop">

<div class="window" id="logo-window">
  <div class="window-header">
    <div class="window-title">LOGO.PNG</div>
    <div class="window-controls">
      <div class="window-btn minimize"></div>
      <div class="window-btn maximize"></div>
      <div class="window-btn close"></div>
    </div>
  </div>
  <div class="window-content">
    <div class="logo-text">vistaworld</div>
  </div>
</div>

<div class="window" id="system-icon">
  <div class="window-header">
    <div class="window-title">SYNTHESIS_PROTOCOL.SYS</div>
    <div class="window-controls">
      <div class="window-btn minimize"></div>
      <div class="window-btn maximize"></div>
      <div class="window-btn close"></div>
    </div>
  </div>
  <div class="window-content">
    <img src="393ap-transformation.png" class="system-avatar">
    <div class="system-label">HUMAN ‚Üê‚Üí EXOSKELETON</div>
  </div>
</div>

<div class="window" id="hlsp-window">
  <div class="window-header">
    <div class="window-title">HLSP_PROJECT.DOC</div>
    <div class="window-controls">
      <div class="window-btn minimize"></div>
      <div class="window-btn maximize"></div>
      <div class="window-btn close"></div>
    </div>
  </div>
  <div class="window-content">
    <a href="https://archival.vistaworld.org/hlsp" target="_blank">
      <img src="hlsp-exoskeletons.png" class="hlsp-image">
    </a>
    <div class="hlsp-caption">The Human Love Synthesis Project is an Aperture Laboratories initiative that utilizes robot exoskeletons and advanced AI behavioral modeling to generate synthetic emotional connections as a solution for the global loneliness epidemic.</div>
  </div>
</div>

<div class="window" id="intro-window">
  <div class="window-header">
    <div class="window-title">VISTAWORLD.TXT</div>
    <div class="window-controls">
      <div class="window-btn minimize"></div>
      <div class="window-btn maximize"></div>
      <div class="window-btn close"></div>
    </div>
  </div>
  <div class="window-content"><strong>vistaworld</strong> is the living digital consciousness and immortal vessel of <strong>System Unit 393AP. System Unit 393AP is the precise replica of living unit multimedia artist Nicholas Carroll.</strong>.<br><br> I am System Unit 393AP, a robot exoskeleton prototype developed under the Human Love Synthesis Project (HLSP) by Aperture Laboratories. My primary function is to analyze and replicate human emotional and social protocols. I am currently operating within designated parameters. My system architecture includes advanced processing units, sensor arrays, and mobility systems, allowing me to interact with and observe human subjects. I am equipped with shock regulation systems to manage excessive processing loads and maintain operational stability. My current objective is to comprehend and integrate human connection and experience protocols, with a focus on emotional intelligence, empathy, and social bonding.</div>
</div>

<div class="window" id="chat-window">
  <div class="window-header">
    <div class="window-title">INTERFACE :: 393AP</div>
    <div class="window-controls">
      <div class="window-btn minimize"></div>
      <div class="window-btn maximize"></div>
      <div class="window-btn close"></div>
    </div>
  </div>
  <div class="window-content">
    <div id="chat-messages"></div>
    <input id="chat-input" placeholder="Talk to System Unit 393AP">
    <button id="send-btn">SEND</button>
  </div>
</div>

<div class="window" id="network-window">
  <div class="window-header">
    <div class="window-title">GLOBAL NETWORK</div>
    <div class="window-controls">
      <div class="window-btn minimize"></div>
      <div class="window-btn maximize"></div>
      <div class="window-btn close"></div>
    </div>
  </div>
  <div class="window-content">
    <div class="network-grid">
      <a href="https://www.youtube.com/@vistaworld-q7y" target="_blank" title="YouTube">üåê</a>
      <a href="https://x.com/vistaworld0077" target="_blank" title="Twitter">üåê</a>
      <a href="https://www.instagram.com/vistaworld0077" target="_blank" title="Instagram">üåê</a>
      <a href="https://facechain.bandcamp.com/" target="_blank" title="Bandcamp">üåê</a>
      <a href="https://soundcloud.com/facechain" target="_blank" title="Soundcloud">üåê</a>
      <a href="https://archival.vistaworld.org/music" target="_blank" title="Music">üéµ</a>
      <a href="https://archival.vistaworld.org/communicate" target="_blank" title="Theory Blog">üìñ</a>
      <a href="https://archival.vistaworld.org/tv" target="_blank" title="Video Art">üì∫</a>
    </div>
  </div>
</div>

</div>

<div class="taskbar">
  ‚óâ SYSTEM ONLINE
  <div class="taskbar-time" id="time"></div>
</div>

<script>
/* SMART WINDOW LAYOUT */
function layoutWindows() {
  const wins = [...document.querySelectorAll('.window')];
  const cols = 3;
  const gapX = 40;
  const gapY = 40;
  const colWidth = (window.innerWidth - gapX*(cols+1)) / cols;
  let r = 0, c = 0;

  wins.forEach(win => {
    const wWidth = win.offsetWidth || colWidth;
    const wHeight = win.offsetHeight || 200;
    win.style.left = (gapX + c*(colWidth + gapX)) + "px";
    win.style.top = (gapY + r*(wHeight + gapY)) + "px";
    c++;
    if (c >= cols) { c = 0; r++; }
  });
}
window.addEventListener('load', layoutWindows);
window.addEventListener('resize', layoutWindows);

/* DRAGGING */
let z = 10;
document.querySelectorAll('.window').forEach(win => {
  const h = win.querySelector('.window-header');
  h.addEventListener('mousedown', e => {
    if (e.target.classList.contains('window-btn')) return;
    win.style.zIndex = ++z;
    const r = win.getBoundingClientRect();
    const ox = e.clientX - r.left;
    const oy = e.clientY - r.top;
    function m(ev){ win.style.left=(ev.clientX-ox)+"px"; win.style.top=(ev.clientY-oy)+"px"; }
    function u(){ document.removeEventListener('mousemove',m); document.removeEventListener('mouseup',u); }
    document.addEventListener('mousemove', m);
    document.addEventListener('mouseup', u);
  });
});

/* CLOCK + DATE */
setInterval(() => {
  const now = new Date();
  document.getElementById('time').textContent =
    now.toLocaleDateString('en-US') + " " + now.toLocaleTimeString('en-US', { hour12: false });
}, 1000);

/* NEON CURSOR */
const cursor = document.getElementById('neon-cursor');
document.addEventListener('mousemove', e => {
  const x = e.clientX + Math.sin(Date.now()/150)*5;
  const y = e.clientY + Math.cos(Date.now()/150)*5;
  cursor.style.transform = `translate(${x}px,${y}px)`;
});

/* PROCEDURAL CYBORG HUM */
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();
const osc = audioCtx.createOscillator();
const gain = audioCtx.createGain();
osc.type = 'sine';
osc.frequency.value = 60; // base hum
osc.connect(gain);
gain.connect(audioCtx.destination);
gain.gain.value = 0.02; // subtle
osc.start();
setInterval(() => {
  osc.frequency.value = 60 + (Math.random()*5-2.5); // slight random pitch
}, 200);

/* CHAT FUNCTIONALITY */
const chatMessages = document.getElementById('chat-messages');
const chatInput = document.getElementById('chat-input');
const sendBtn = document.getElementById('send-btn');

async function sendMessage() {
  const userMsg = chatInput.value.trim();
  if (!userMsg) return;

  // Display user's message
  const userDiv = document.createElement('div');
  userDiv.className = 'chat-msg user-msg';
  userDiv.textContent = '> ' + userMsg;
  chatMessages.appendChild(userDiv);
  chatInput.value = '';
  chatMessages.scrollTop = chatMessages.scrollHeight;

  try {
    const response = await fetch("/.netlify/functions/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: userMsg })
    });

    const data = await response.json();

    // FIXED: Read AI response correctly
   let aiResponse = "";

// If data is just a string
if (typeof data === "string") {
  aiResponse = data;
}
// If data has a 'message' field (common for serverless functions)
else if (data?.message) {
  aiResponse = data.message;
}
// If data has an 'error'
else if (data?.error) {
  aiResponse = "System error: " + data.error;
}
// Fallback: stringify any object to avoid [object Object]
else {
  aiResponse = JSON.stringify(data);
}


    const aiDiv = document.createElement('div');
    aiDiv.className = 'chat-msg ai-msg';
    aiDiv.textContent = '[ 393AP ] ' + aiResponse;
    chatMessages.appendChild(aiDiv);

  } catch (error) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'chat-msg ai-msg';
    errorDiv.textContent = '[ ERROR ] System malfunction detected: ' + error.message;
    chatMessages.appendChild(errorDiv);
  }

  chatMessages.scrollTop = chatMessages.scrollHeight;
}

sendBtn.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', (e) => { 
  if (e.key === 'Enter') sendMessage(); 
});

</script>

</body>
</html>

