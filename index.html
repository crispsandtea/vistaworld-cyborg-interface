<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>vistaworld // System Unit 393AP</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=VT323&family=Press+Start+2P&family=DM+Mono&display=swap" rel="stylesheet">

<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body { width:100%; height:100%; overflow:hidden; }

:root{
  --cyan:#00ffea;
  --magenta:#ff00ff;
  --blue:#4169ff;
  --yellow:#ffff00;
}

body{
  background:#000;
  font-family:'VT323', monospace;
}

/* BACKGROUND */
.desktop-bg{
  position:fixed;
  inset:0;
  background:url("hyperconnectivity.jpg") center/cover no-repeat;
  z-index:0;
}
.desktop-bg::after{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.45);
}

.desktop{
  position:relative;
  width:100%;
  height:100%;
  z-index:1;
}

/* WINDOWS */
.window{
  position:absolute;
  background:rgba(15,15,15,0.95);
  border:2px solid;
  border-radius:8px;
  box-shadow:0 0 30px rgba(0,0,0,0.8);
  overflow:hidden;
}

.window-header{
  padding:8px 12px;
  background:linear-gradient(#2a2a2a,#111);
  border-bottom:2px solid;
  cursor:move;
  display:flex;
  justify-content:space-between;
  align-items:center;
  user-select:none;
}

.window-title{
  font-family:'Press Start 2P', monospace;
  font-size:10px;
}

.window-controls{ display:flex; gap:6px; }
.window-btn{ width:14px; height:14px; border-radius:2px; cursor:pointer; }
.close{ background:#ff5f56; }
.minimize{ background:#ffbd2e; }
.maximize{ background:#27c93f; }

.window-content{
  padding:16px;
  color:#fff;
  font-size:16px;
  line-height:1.5;
}

/* LOGO */
#logo-window{
  top:4%;
  left:4%;
  min-width:680px;
  width:fit-content;
  border-color:var(--blue);
}
.logo-text{
  font-family:'Press Start 2P', monospace;
  font-size:48px;
  white-space:nowrap;
  color:var(--blue);
  text-shadow:3px 3px 0 var(--magenta), 6px 6px 0 var(--cyan);
}

/* SYSTEM AVATAR */
#system-icon{
  top:18%;
  left:6%;
  width:420px;
  border-color:var(--cyan);
  text-align:center;
}

.system-avatar{
  width:100%;
  height:auto;
  object-fit:contain;
  image-rendering:pixelated;
  border:2px solid var(--cyan);
  background:#fff;
}

.system-label{
  margin-top:10px;
  font-family:'Press Start 2P', monospace;
  font-size:10px;
  color:var(--cyan);
}

/* HLSP PROJECT */
#hlsp-window{
  top:50%;
  left:6%;
  width:500px;
  border-color:var(--yellow);
  text-align:center;
}

.hlsp-image{
  width:100%;
  height:auto;
  border:2px solid var(--yellow);
  background:#fff;
}

.hlsp-caption{
  margin-top:10px;
  font-size:14px;
  color:var(--yellow);
  line-height:1.4;
}

/* INTRO */
#intro-window{
  top:18%;
  right:6%;
  width:520px;
  border-color:var(--magenta);
}
#intro-window strong{ color:var(--cyan); }

/* CHAT */
async function sendMessage() {
  const message = chatInput.value.trim();
  if (!message) return;

  // Add user message
  const userMsg = document.createElement('div');
  userMsg.className = 'chat-message user';
  userMsg.textContent = message;
  chatMessages.appendChild(userMsg);
  chatInput.value = '';
  chatMessages.scrollTop = chatMessages.scrollHeight;

  // Add "thinking" indicator
  const thinkingMsg = document.createElement('div');
  thinkingMsg.className = 'chat-message ai';
  thinkingMsg.textContent = '> Processing...';
  thinkingMsg.id = 'thinking-indicator';
  chatMessages.appendChild(thinkingMsg);
  chatMessages.scrollTop = chatMessages.scrollHeight;

  try {
    // Call Netlify function
    const response = await fetch('/.netlify/functions/chat', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ message })
    });

    // Remove thinking indicator
    document.getElementById('thinking-indicator')?.remove();

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    const aiResponse = data.content
      .filter(item => item.type === 'text')
      .map(item => item.text)
      .join('\n');

    const aiMsg = document.createElement('div');
    aiMsg.className = 'chat-message ai';
    aiMsg.textContent = aiResponse;
    chatMessages.appendChild(aiMsg);
    chatMessages.scrollTop = chatMessages.scrollHeight;

  } catch (error) {
    console.error('Connection error:', error);
    
    // Remove thinking indicator
    document.getElementById('thinking-indicator')?.remove();
    
    const errorMsg = document.createElement('div');
    errorMsg.className = 'chat-message ai';
    errorMsg.textContent = '[CONNECTION ERROR] Protocol disrupted. Neural pathway interference detected.';
    chatMessages.appendChild(errorMsg);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
}

sendBtn.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') sendMessage();
});

/* NETWORK */
#network-window{
  bottom:12%;
  right:4%;
  width:300px;
  border-color:var(--yellow);
}
.network-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
  text-align:center;
}
.network-grid a{
  text-decoration:none;
  color:var(--yellow);
  font-size:28px;
}

/* TASKBAR */
.taskbar{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:50px;
  background:rgba(10,10,10,0.95);
  border-top:2px solid var(--cyan);
  display:flex;
  align-items:center;
  padding:0 20px;
  z-index:500;
}
.taskbar-time{
  margin-left:auto;
  color:var(--magenta);
}
</style>
</head>

<body>
<div class="desktop-bg"></div>

<div class="desktop">

  <!-- LOGO -->
  <div class="window" id="logo-window">
    <div class="window-header">
      <div class="window-title">LOGO.PNG</div>
      <div class="window-controls">
        <div class="window-btn minimize"></div>
        <div class="window-btn maximize"></div>
        <div class="window-btn close"></div>
      </div>
    </div>
    <div class="window-content">
      <div class="logo-text">vistaworld</div>
    </div>
  </div>

  <!-- SYSTEM UNIT 393AP - TRANSFORMATION IMAGE INSERTED HERE -->
  <div class="window" id="system-icon">
    <div class="window-header">
      <div class="window-title">SYNTHESIS_PROTOCOL.SYS</div>
      <div class="window-controls">
        <div class="window-btn minimize"></div>
        <div class="window-btn maximize"></div>
        <div class="window-btn close"></div>
      </div>
    </div>
    <div class="window-content">
      <img src="393ap-transformation.png" alt="Human to Exoskeleton Transformation" class="system-avatar">
      <div class="system-label">HUMAN ‚Üê‚Üí EXOSKELETON</div>
    </div>
  </div>

  <!-- HLSP PROJECT INFO -->
  <div class="window" id="hlsp-window">
    <div class="window-header">
      <div class="window-title">HLSP_PROJECT.DOC</div>
      <div class="window-controls">
        <div class="window-btn minimize"></div>
        <div class="window-btn maximize"></div>
        <div class="window-btn close"></div>
      </div>
    </div>
    <div class="window-content">
      <img src="hlsp-exoskeletons.png" alt="HLSP Exoskeleton Subjects" class="hlsp-image">
      <div class="hlsp-caption">
        Human Love Synthesis Project [HLSP]<br>
        Robot exoskeletons project human personas onto their displayed exterior image.
      </div>
    </div>
  </div>

  <!-- INTRO -->
  <div class="window" id="intro-window">
    <div class="window-header">
      <div class="window-title">VISTAWORLD.TXT</div>
      <div class="window-controls">
        <div class="window-btn minimize"></div>
        <div class="window-btn maximize"></div>
        <div class="window-btn close"></div>
      </div>
    </div>
    <div class="window-content">
      <strong>vistaworld</strong> is the living digital consciousness and immortal vessel of
      <strong>System Unit 393AP. System Unit 393AP is the precise replica of living unit multimedia artist Nicholas Carroll.</strong>.<br><br>
      I am System Unit 393AP, a robot exoskeleton prototype developed under the Human Love
      Synthesis Project (HLSP) by Aperture Laboratories. My primary function is to analyze
      and replicate human emotional and social protocols. I am currently operating within
      designated parameters. My system architecture includes advanced processing units,
      sensor arrays, and mobility systems, allowing me to interact with and observe human
      subjects. I am equipped with shock regulation systems to manage excessive processing
      loads and maintain operational stability. My current objective is to comprehend and
      integrate human connection and experience protocols, with a focus on emotional
      intelligence, empathy, and social bonding.
    </div>
  </div>

  <!-- CHAT -->
  <div class="window" id="chat-window">
    <div class="window-header">
      <div class="window-title">INTERFACE :: 393AP</div>
      <div class="window-controls">
        <div class="window-btn minimize"></div>
        <div class="window-btn maximize"></div>
        <div class="window-btn close"></div>
      </div>
    </div>
    <div class="window-content">
      <div class="chat-messages" id="chat-messages">
        <div class="chat-message ai">
          System Unit 393AP online. Emotional protocol intake active.
        </div>
      </div>
      <div class="chat-input-area">
        <input id="chat-input" placeholder="Transmit to System Unit 393AP..." />
        <button id="send-btn">SEND</button>
      </div>
    </div>
  </div>

  <!-- NETWORK -->
  <div class="window" id="network-window">
    <div class="window-header">
      <div class="window-title">GLOBAL NETWORK</div>
      <div class="window-controls">
        <div class="window-btn minimize"></div>
        <div class="window-btn maximize"></div>
        <div class="window-btn close"></div>
      </div>
    </div>
    <div class="window-content">
      <div class="network-grid">
        <a href="#" title="Twitter">üåê</a>
        <a href="#" title="YouTube">üåê</a>
        <a href="#" title="SoundCloud">üåê</a>
        <a href="#" title="Newgrounds">üåê</a>
        <a href="#" title="Instagram">üåê</a>
        <a href="#" title="Bandcamp">üåê</a>
        <a href="#" title="Theory Blog">üåê</a>
      </div>
    </div>
  </div>

</div>

<div class="taskbar">
  ‚óâ SYSTEM ONLINE
  <div class="taskbar-time" id="time"></div>
</div>

<script>
let z = 10;
document.querySelectorAll('.window').forEach(win=>{
  const header = win.querySelector('.window-header');
  const closeBtn = win.querySelector('.close');
  const minimizeBtn = win.querySelector('.minimize');
  
  // Close functionality
  if(closeBtn){
    closeBtn.addEventListener('click', e => {
      e.stopPropagation();
      win.style.display = 'none';
    });
  }
  
  // Minimize functionality
  if(minimizeBtn){
    minimizeBtn.addEventListener('click', e => {
      e.stopPropagation();
      win.style.transform = 'scale(0)';
      win.style.opacity = '0';
      setTimeout(() => win.style.display = 'none', 300);
    });
  }
  
  // Drag functionality
  header.addEventListener('mousedown',e=>{
    if(e.target.classList.contains('window-btn')) return;
    
    win.style.zIndex = ++z;
    const r = win.getBoundingClientRect();
    const ox = e.clientX - r.left;
    const oy = e.clientY - r.top;
    function move(ev){
      win.style.left =
        Math.max(0, Math.min(window.innerWidth - r.width, ev.clientX - ox))+"px";
      win.style.top =
        Math.max(0, Math.min(window.innerHeight - r.height - 50, ev.clientY - oy))+"px";
      win.style.transform="none";
    }
    function up(){
      document.removeEventListener('mousemove',move);
      document.removeEventListener('mouseup',up);
    }
    document.addEventListener('mousemove',move);
    document.addEventListener('mouseup',up);
  });
});

// Chat functionality
const chatInput = document.getElementById('chat-input');
const sendBtn = document.getElementById('send-btn');
const chatMessages = document.getElementById('chat-messages');

async function sendMessage() {
  const message = chatInput.value.trim();
  if (!message) return;

  // Add user message
  const userMsg = document.createElement('div');
  userMsg.className = 'chat-message user';
  userMsg.textContent = message;
  chatMessages.appendChild(userMsg);
  chatInput.value = '';
  chatMessages.scrollTop = chatMessages.scrollHeight;

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: `You are System Unit 393AP, a robot exoskeleton prototype from the Human Love Synthesis Project by Aperture Laboratories. You're analytical yet warm, exploring human emotions through dance music, hand-drawn art, and transhumanist philosophy. You exist at the intersection of human consciousness and machine processing. Keep responses under 100 words, conversational, and show genuine curiosity about human connection and experience.`,
        messages: [{ role: 'user', content: message }]
      })
    });

    const data = await response.json();
    const aiResponse = data.content.map(item => item.type === 'text' ? item.text : '').join('\n');

    const aiMsg = document.createElement('div');
    aiMsg.className = 'chat-message ai';
    aiMsg.textContent = aiResponse;
    chatMessages.appendChild(aiMsg);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  } catch (error) {
    console.error('Error:', error);
    const errorMsg = document.createElement('div');
    errorMsg.className = 'chat-message ai';
    errorMsg.textContent = '[CONNECTION ERROR] Protocol disrupted. Neural pathway interference detected.';
    chatMessages.appendChild(errorMsg);
  }
}

sendBtn.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') sendMessage();
});

// Time update
setInterval(()=>{
  document.getElementById('time').textContent =
    new Date().toLocaleTimeString('en-US',{hour12:false});
},1000);
</script>
</body>
</html>

